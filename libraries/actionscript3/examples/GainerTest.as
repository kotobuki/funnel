package {	import flash.display.Shape;	import flash.display.Sprite;	import flash.events.Event;	import funnel.*;	/**	 * ボタンが押されている間LEDをサイン波でドライブする。	 * Drive a LED with sin wave while the button is pressed.	 *	 * <p>準備<ol>	 * <li>aout 0にLEDを接続する（電流制限のための抵抗器が必要）</li>	 * <li>ain 0にセンサを接続する（例：ボリューム）</li>	 * </ol></p>	 *	 * <p>Preparation<ol>	 * <li>Connect a LED to aout 0 (current-limiting resistor is needed)</li>	 * <li>Connect a sensor to ain 0 (e.g. a potentiometer)</li>	 * </ol></p>	 */	public class GainerTest extends Sprite {		// To change number of analog channels, modify this constant		// 表示するアナログチャンネル数を変更するにはこの定数を変更する		private const NUM_CHANNELS:int = 1;		private var gio:Gainer;		private var scope:SimpleScope;		private var scopes:Array;		public function GainerTest() {			gio = new Gainer();			gio.addEventListener(FunnelEvent.READY, trace);			gio.addEventListener(FunnelErrorEvent.REBOOT_ERROR, trace);			gio.addEventListener(FunnelErrorEvent.CONFIGURATION_ERROR, trace);			gio.addEventListener(FunnelErrorEvent.ERROR, trace);			scopes = new Array(NUM_CHANNELS);			for (var i:int = 0; i < NUM_CHANNELS; i++) {				scopes[i] = new SimpleScope(10, 10 + (60 * i), 200);				addChild(scopes[i]);			}			var circle:Shape = new Shape();			circle.graphics.beginFill(0x000000);			circle.graphics.drawCircle(0, 0, 50);			circle.graphics.endFill();			circle.alpha = 0.2;			circle.x = 300;			circle.y = 70;			this.addChild(circle);			var externalLED:Port = gio.analogOutput(0);			externalLED.filters = [new Osc(Osc.SQUARE, 0.5, 1, 0, 0)];			// Uncomment the following line to enable MOVING_AVERAGE filter for ain 0			// 次の行をアンコメントするとain 0に対してMOVING_AVERAGEフィルタが有効になる//			gio.analogInput(0).filters = [new Convolution(Convolution.MOVING_AVERAGE)];						gio.button.addEventListener(PortEvent.RISING_EDGE, function(e:Event):void {				gio.led.value = 1;				circle.alpha = 1.0;				externalLED.filters[0].reset();				externalLED.filters[0].start();			});			gio.button.addEventListener(PortEvent.FALLING_EDGE, function(e:Event):void {				gio.led.value = 0;				circle.alpha = 0.2;				externalLED.filters[0].stop();				externalLED.value = 0.0;			});			addEventListener(Event.ENTER_FRAME, loop);		}		private function loop(event:Event):void {			for (var i:int = 0; i < NUM_CHANNELS; i++) {				scopes[i].update(gio.analogInput(i).value);			}		}	}}